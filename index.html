<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram To-Do Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã Telegram */
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-link: var(--tg-theme-link-color, #2481cc);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 { margin-bottom: 20px; width: 100%; text-align: left; }

        .input-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-row {
            display: flex;
            gap: 8px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--tg-hint);
            border-radius: 10px;
            background: var(--tg-bg);
            color: var(--tg-text);
            outline: none;
        }

        /* –°–µ–ª–µ–∫—Ç–æ—Ä –≤–∞–∂–Ω–æ—Å—Ç–∏ */
        select {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--tg-hint);
            background: var(--tg-bg);
            color: var(--tg-text);
        }

        button#addBtn {
            padding: 12px 20px;
            background-color: var(--tg-link);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }

        ul {
            list-style: none;
            padding: 0;
            width: 100%;
        }

        li {
            background: var(--tg-secondary-bg);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.1s;
            border-left: 5px solid transparent;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á */
        li.important {
            border-left: 5px solid #ff4b4b; /* –ö—Ä–∞—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ä */
            background: rgba(255, 75, 75, 0.1);
        }

        .delete-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--tg-hint);
        }

        .task-text {
            flex: 1;
        }

        .priority-tag {
            font-size: 10px;
            text-transform: uppercase;
            margin-right: 8px;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--tg-hint);
            color: #fff;
        }
    </style>
</head>
<body>

    <h2>–ú–æ–π –°–ø–∏—Å–æ–∫ –î–µ–ª üöÄ</h2>

    <div class="input-container">
        <div class="input-row">
            <input type="text" id="taskInput" placeholder="–ß—Ç–æ –∫—É–ø–∏–º/—Å–¥–µ–ª–∞–µ–º?">
            <select id="prioritySelect">
                <option value="normal">–û–±—ã—á–Ω–æ–µ</option>
                <option value="high">–í–∞–∂–Ω–æ–µ üî•</option>
            </select>
        </div>
        <button id="addBtn">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </div>

    <ul id="taskList"></ul>

    <script>
        const tg = window.Telegram.WebApp;
        const addBtn = document.getElementById('addBtn');
        const taskInput = document.getElementById('taskInput');
        const prioritySelect = document.getElementById('prioritySelect');
        const taskList = document.getElementById('taskList');

        // –°–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
        tg.ready();
        tg.expand();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ (–≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞)
        tg.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–ß–ï–¢ –ë–û–¢–£");
        tg.MainButton.textColor = "#FFFFFF";
        tg.MainButton.color = "#2ec126"; // –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
        addBtn.addEventListener('click', () => {
            const text = taskInput.value.trim();
            const priority = prioritySelect.value;

            if (text === "") {
                tg.showAlert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏!");
                return;
            }

            const li = document.createElement('li');
            if (priority === 'high') li.classList.add('important');

            li.innerHTML = `
                <div class="task-text">
                    ${priority === 'high' ? '<span class="priority-tag">–í–∞–∂–Ω–æ–µ</span>' : ''}
                    <span>${text}</span>
                </div>
                <button class="delete-btn">‚úï</button>
            `;

            // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
            li.querySelector('.delete-btn').addEventListener('click', () => {
                li.remove();
                if (taskList.children.length === 0) tg.MainButton.hide();
            });

            taskList.appendChild(li);
            taskInput.value = "";
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–¥–∞—á–∏
            tg.MainButton.show();
        });

        // –õ–æ–≥–∏–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –¢–µ–ª–µ–≥—Ä–∞–º–∞
        tg.onEvent('mainButtonClicked', function() {
            const tasks = [];
            document.querySelectorAll('#taskList li').forEach(li => {
                tasks.push({
                    text: li.querySelector('.task-text span:last-child').innerText,
                    important: li.classList.contains('important')
                });
            });

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
            tg.sendData(JSON.stringify(tasks));
        });
    </script>
</body>
</html>
