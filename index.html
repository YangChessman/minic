<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ultimate Self-Dev</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-link: var(--tg-theme-link-color, #2481cc);
            --tg-sec-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --gold: #ffcf40;
        }

        body { font-family: sans-serif; background: var(--tg-bg); color: var(--tg-text); margin: 0; padding-bottom: 80px; }
        
        /* –ü–∏—Ç–æ–º–µ—Ü –≤ —É–≥–ª—É */
        #pet-container {
            position: fixed; top: 60px; right: 10px; font-size: 40px; 
            z-index: 100; display: none; filter: drop-shadow(0 0 5px rgba(0,0,0,0.2));
            animation: float 2s infinite ease-in-out;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .header { display: flex; justify-content: space-between; padding: 15px; background: var(--tg-sec-bg); font-weight: bold; }
        .coin-balance { color: var(--gold); }

        .page { display: none; padding: 15px; }
        .active { display: block; }

        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .card { background: var(--tg-sec-bg); border-radius: 12px; padding: 15px; margin-bottom: 10px; text-align: center; cursor: pointer; }
        .btn-main { background: var(--tg-link); color: white; border: none; border-radius: 8px; padding: 12px; width: 100%; margin-top: 10px; font-weight: bold; }
        
        /* –°–µ—Ç–∫–∞ –≤–∫–ª–∞–¥–æ–∫ */
        .tab-bar { position: fixed; bottom: 0; width: 100%; display: flex; background: var(--tg-sec-bg); height: 65px; border-top: 1px solid #ddd; }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; opacity: 0.5; }
        .active-tab { opacity: 1; color: var(--tg-link); }

        /* –§–æ—Ä–º—ã –ë–ñ–£ */
        input { width: 90%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; background: var(--tg-bg); color: var(--tg-text); }
        
        /* –û–≤–µ—Ä–ª–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */
        #training-overlay { display: none; position: fixed; inset: 0; background: var(--tg-bg); z-index: 200; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body>

    <div id="pet-container">üê±</div>

    <div class="header">
        <span>Level Up App</span>
        <div class="coin-balance">ü™ô <span id="coinCount">0</span></div>
    </div>

    <div id="meditation" class="page active">
        <h3>–ú–µ–¥–∏—Ç–∞—Ü–∏–∏ üßò</h3>
        <div class="card" onclick="startMeditation('–î—ã—Ö–∞–Ω–∏–µ', 5)">üßò –ü–æ–¥—ã—à–∞—Ç—å (5 —Å–µ–∫)</div>
    </div>

    <div id="bju" class="page">
        <h3>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ë–ñ–£ ü•ó</h3>
        <div id="bju-setup">
            <input type="number" id="weight" placeholder="–í–µ—Å (–∫–≥)">
            <input type="number" id="height" placeholder="–†–æ—Å—Ç (—Å–º)">
            <input type="number" id="age" placeholder="–í–æ–∑—Ä–∞—Å—Ç">
            <select id="gender" style="width: 95%; padding: 10px; margin: 5px 0;">
                <option value="male">–ú—É–∂—á–∏–Ω–∞</option>
                <option value="female">–ñ–µ–Ω—â–∏–Ω–∞</option>
            </select>
            <button class="btn-main" onclick="calcBJU()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–æ—Ä–º—É</button>
        </div>
        <div id="bju-tracker" style="display:none;">
            <h4 id="target-text">–í–∞—à–∞ —Ü–µ–ª—å: -</h4>
            <div id="current-stats">–û—Å—Ç–∞–ª–æ—Å—å: - –∫–∫–∞–ª</div>
            <hr>
            <input type="text" id="food-name" placeholder="–ß—Ç–æ —Å—ä–µ–ª–∏?">
            <input type="number" id="food-cal" placeholder="–ö–∞–ª–æ—Ä–∏–∏">
            <button class="btn-main" onclick="addMeal()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–µ–º –ø–∏—â–∏</button>
        </div>
    </div>

    <div id="workout" class="page">
        <h3>–í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –º—ã—à—Ü üí™</h3>
        <div class="card" onclick="initWorkout('–¢—Ä–∏—Ü–µ–ø—Å')">üí™ –¢—Ä–∏—Ü–µ–ø—Å</div>
        <div class="card" onclick="initWorkout('–ë–∏—Ü–µ–ø—Å')">‚úä –ë–∏—Ü–µ–ø—Å</div>
    </div>

    <div id="shop" class="page">
        <h3>–ú–∞–≥–∞–∑–∏–Ω üõí</h3>
        <div class="card">
            <span>–ö–æ—Ç-–∫–æ–º–ø–∞–Ω—å–æ–Ω üê±</span><br>
            <small>–¶–µ–Ω–∞: 50 –∫–æ–∏–Ω–æ–≤</small>
            <button class="btn-main" onclick="buyPet('üê±', 50)">–ö—É–ø–∏—Ç—å</button>
        </div>
    </div>

    <div id="training-overlay">
        <h2 id="ex-title">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
        <div id="ex-desc" style="font-size: 18px; text-align: center; margin: 20px;"></div>
        <button id="next-ex-btn" class="btn-main">–°–ª–µ–¥—É—é—â–µ–µ ‚û°Ô∏è</button>
        <button onclick="finishWorkout()" class="btn-main" style="background: #eb4034;">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </div>

    <nav class="tab-bar">
        <div class="tab-item active-tab" onclick="openPage('meditation', this)"><span>üßò</span><span>–ú–µ–¥–∏—Ç–∞—Ü–∏—è</span></div>
        <div class="tab-item" onclick="openPage('bju', this)"><span>ü•ó</span><span>–ë–ñ–£</span></div>
        <div class="tab-item" onclick="openPage('workout', this)"><span>üí™</span><span>–ó–∞–ª</span></div>
        <div class="tab-item" onclick="openPage('shop', this)"><span>üõí</span><span>–ú–∞–≥–∞–∑–∏–Ω</span></div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let hasPet = localStorage.getItem('hasPet') === 'true';
        let dailyTarget = 0;
        let currentCal = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateCoins(0);
        if(hasPet) document.getElementById('pet-container').style.display = 'block';

        function updateCoins(amount) {
            coins += amount;
            document.getElementById('coinCount').innerText = coins;
            localStorage.setItem('coins', coins);
        }

        function openPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(pageId).classList.add('active');
            el.classList.add('active-tab');
        }

        // --- –õ–û–ì–ò–ö–ê –ë–ñ–£ ---
        function calcBJU() {
            const w = document.getElementById('weight').value;
            const h = document.getElementById('height').value;
            const a = document.getElementById('age').value;
            const g = document.getElementById('gender').value;

            if(!w || !h || !a) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!");

            // –§–æ—Ä–º—É–ª–∞ –ú–∏—Ñ—Ñ–ª–∏–Ω–∞-–°–∞–Ω –ñ–µ–æ—Ä–∞
            if(g === 'male') dailyTarget = (10 * w) + (6.25 * h) - (5 * a) + 5;
            else dailyTarget = (10 * w) + (6.25 * h) - (5 * a) - 161;

            dailyTarget = Math.round(dailyTarget);
            currentCal = dailyTarget;

            document.getElementById('bju-setup').style.display = 'none';
            document.getElementById('bju-tracker').style.display = 'block';
            document.getElementById('target-text').innerText = `–í–∞—à–∞ –Ω–æ—Ä–º–∞: ${dailyTarget} –∫–∫–∞–ª`;
            updateBjuUI();
        }

        function addMeal() {
            const cal = document.getElementById('food-cal').value;
            if(!cal) return;
            currentCal -= cal;
            updateBjuUI();
            document.getElementById('food-name').value = '';
            document.getElementById('food-cal').value = '';
        }

        function updateBjuUI() {
            document.getElementById('current-stats').innerText = `–û—Å—Ç–∞–ª–æ—Å—å: ${currentCal} –∫–∫–∞–ª`;
        }

        // --- –õ–û–ì–ò–ö–ê –¢–†–ï–ù–ò–†–û–í–û–ö ---
        const exercisesDB = {
            '–¢—Ä–∏—Ü–µ–ø—Å': [
                { name: '–û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –±—Ä—É—Å—å—è—Ö', desc: '–î–µ—Ä–∂–∏—Ç–µ —Å–ø–∏–Ω—É –ø—Ä—è–º–æ, –ª–æ–∫—Ç–∏ –Ω–∞–∑–∞–¥' },
                { name: '–†–∞–∑–≥–∏–±–∞–Ω–∏—è —Ä—É–∫', desc: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–∞–Ω—Ç–µ–ª—å –∑–∞ –≥–æ–ª–æ–≤—É' }
            ],
            '–ë–∏—Ü–µ–ø—Å': [
                { name: '–ü–æ–¥—ä–µ–º —à—Ç–∞–Ω–≥–∏', desc: '–ù–µ —Ä–∞—Å–∫–∞—á–∏–≤–∞–π—Ç–µ—Å—å –∫–æ—Ä–ø—É—Å–æ–º' },
                { name: '–ú–æ–ª–æ—Ç–∫–∏', desc: '–•–≤–∞—Ç –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π' }
            ]
        };

        let currentExList = [];
        let currentExIdx = 0;

        function initWorkout(group) {
            currentExList = exercisesDB[group];
            currentExIdx = 0;
            document.getElementById('training-overlay').style.display = 'flex';
            showExercise();
        }

        function showExercise() {
            const ex = currentExList[currentExIdx];
            document.getElementById('ex-title').innerText = ex.name;
            document.getElementById('ex-desc').innerText = ex.desc;
            
            if(currentExIdx === currentExList.length - 1) {
                document.getElementById('next-ex-btn').style.display = 'none';
            } else {
                document.getElementById('next-ex-btn').style.display = 'block';
            }
        }

        document.getElementById('next-ex-btn').onclick = () => {
            currentExIdx++;
            showExercise();
        }

        function finishWorkout() {
            document.getElementById('training-overlay').style.display = 'none';
            updateCoins(50);
            tg.showAlert("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! +50 –º–æ–Ω–µ—Ç");
        }

        // --- –ú–ê–ì–ê–ó–ò–ù ---
        function buyPet(emoji, price) {
            if(coins >= price && !hasPet) {
                updateCoins(-price);
                hasPet = true;
                localStorage.setItem('hasPet', 'true');
                document.getElementById('pet-container').style.display = 'block';
                tg.showAlert("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –Ω–æ–≤—ã–º –¥—Ä—É–≥–æ–º!");
            } else if (hasPet) {
                tg.showAlert("–ü–∏—Ç–æ–º–µ—Ü —É–∂–µ –µ—Å—Ç—å!");
            } else {
                tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
            }
        }

        // --- –ú–ï–î–ò–¢–ê–¶–ò–Ø ---
        function startMeditation(name, time) {
            tg.showConfirm(`–ù–∞—á–∞—Ç—å –º–µ–¥–∏—Ç–∞—Ü–∏—é "${name}"?`, (ok) => {
                if(ok) {
                    let sec = time;
                    const interval = setInterval(() => {
                        sec--;
                        if(sec <= 0) {
                            clearInterval(interval);
                            updateCoins(15);
                            tg.showAlert("–ì–æ—Ç–æ–≤–æ! +15 –º–æ–Ω–µ—Ç");
                        }
                    }, 1000);
                }
            });
        }
    </script>
</body>
</html>
